# KinoVzor v2.0.0 - ะะพะฑะธะปัะฝะฐั ะบะธะฝะพัะตะบะฐ ั ัะตัะตะฝะทะธัะผะธ

![Version](https://img.shields.io/badge/version-2.0.0-blue.svg)
![Python](https://img.shields.io/badge/python-3.8+-green.svg)
![License](https://img.shields.io/badge/license-MIT-blue.svg)

ะัะธะปะพะถะตะฝะธะต ะดะปั ะฟัะพัะผะพััะฐ ะธ ัะตัะตะฝะทะธัะพะฒะฐะฝะธั ัะธะปัะผะพะฒ ั ะฟะพะปะฝัะผ CRUD ััะฝะบัะธะพะฝะฐะปะพะผ.

## โจ ะัะฝะพะฒะฝัะต ััะฝะบัะธะธ

- โ **ะะฒัะพัะธะทะฐัะธั ะธ ัะตะณะธัััะฐัะธั** ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ัะตัะธัะพะฒะฐะฝะธะตะผ ะฟะฐัะพะปะตะน
- โ **ะะพะปะฝัะน CRUD** ะดะปั ัะธะปัะผะพะฒ, ะพัะทัะฒะพะฒ ะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ **ะัะพัะผะพัั ัะธะปัะผะพะฒ** ั ัะตะนัะธะฝะณะพะผ ะธ ะธะฝัะพัะผะฐัะธะตะน
- โ **ะะฐะฟะธัะฐะฝะธะต ัะตัะตะฝะทะธะน** ั ะพัะตะฝะบะฐะผะธ (1-5 ะทะฒะตะทะด)
- โ **ะะพะฑะฐะฒะปะตะฝะธะต ะฒ ะธะทะฑัะฐะฝะฝะพะต** (ะทะฐะบะปะฐะดะบะธ)
- โ **ะคะธะปัััะฐัะธั ะฟะพ ะถะฐะฝัะฐะผ** ะธ ัะพััะธัะพะฒะบะฐ
- โ **ะะฐะฝะตะปั ะผะพะดะตัะฐัะพัะฐ** ะดะปั ะพะดะพะฑัะตะฝะธั ัะตัะตะฝะทะธะน
- โ **ะะดะผะธะฝะธัััะฐัะธะฒะฝะฐั ะฟะฐะฝะตะปั** ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะบะพะฝัะตะฝัะพะผ
- โ **API ะดะพะบัะผะตะฝัะฐัะธั** ัะตัะตะท Swagger UI

## ๐ ะงัะพ ะฝะพะฒะพะณะพ ะฒ v2.0.0

### โ ะะพะฑะฐะฒะปะตะฝะพ
- **CRUD ะพะฟะตัะฐัะธะธ** ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั ะธ ัะดะฐะปะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- **ะฃะดะฐะปะตะฝะธะต ัะธะปัะผะพะฒ** ั ะบะฐัะบะฐะดะฝัะผ ัะดะฐะปะตะฝะธะตะผ ัะตัะตะฝะทะธะน ะธ ะธะทะฑัะฐะฝะฝะพะณะพ
- **ะะฑะฝะพะฒะปะตะฝะธะต ัะตัะตะฝะทะธะน** (ัะตะบัั ะธ ัะตะนัะธะฝะณ)
- **ะะฒัะพะผะฐัะธัะตัะบะพะต ัะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน** ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ bcrypt
- **ะะฐัะบะฐะดะฝะพะต ัะดะฐะปะตะฝะธะต** ะดะปั ัะพััะฐะฝะตะฝะธั ัะตะปะพััะฝะพััะธ ะดะฐะฝะฝัั
- **ะัะดะตะปัะฝัะต ะฟะฐะบะตัั** ะดะปั ะผะพะดะตะปะตะน Favorites ะธ Reviews

### ๐๏ธ ะฃะดะฐะปะตะฝะพ
- **ะขะฐะฑะปะธัะฐ ratings** (ััะฝะบัะธะพะฝะฐะปัะฝะพััั ะฟะตัะตะฝะตัะตะฝะฐ ะฒ reviews)
- **API endpoints ratings** (ะธัะฟะพะปัะทัะนัะต ัะตะนัะธะฝะณะธ ะฒ reviews)

### ๐ ะะฑะฝะพะฒะปะตะฝะพ
- **ะกัััะบัััะฐ ะะ** ั ะฟัะฐะฒะธะปัะฝัะผะธ FK constraints
- **ะะพะบัะผะตะฝัะฐัะธั API** ั ะฝะพะฒัะผะธ endpoints
- **ะะพะด** ั ะปัััะตะน ะพัะณะฐะฝะธะทะฐัะธะตะน ะธ ะพัะดะตะปะตะฝะธะตะผ concerns

## ๐๏ธ ะขะตัะฝะพะปะพะณะธะธ

- **Backend**: FastAPI
- **Database**: SQLite + SQLAlchemy ORM
- **Database Migrations**: Alembic
- **Password Hashing**: Bcrypt (via passlib)
- **Frontend**: Vanilla JavaScript
- **Styling**: CSS

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Python 3.8+
- pip
- Git

## ๐ ะัััััะน ะกัะฐัั

### 1. ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน

```bash
git clone https://github.com/Artem2335/kino1.git
cd kino1
git checkout refactor/crud-operations
```

### 2. ะกะพะทะดะฐะนัะต ะฒะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate    # Windows
```

### 3. ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ

```bash
pip install -r requirements.txt
```

### 4. ะะฝะธัะธะฐะปะธะทะธััะนัะต ะฑะฐะทั ะดะฐะฝะฝัั

```bash
# ะะปั ะฝะพะฒะพะน ัััะฐะฝะพะฒะบะธ
python init_db.py
python seed_db.py

# ะะปะธ ะฟัะธะผะตะฝะธัะต ะผะธะณัะฐัะธั
cd app
alembic upgrade head
cd ..
```

### 5. ะะฐะฟัััะธัะต ัะตัะฒะตั

```bash
python run.py
```

ะัะธะปะพะถะตะฝะธะต ะฑัะดะตั ะดะพัััะฟะฝะพ ะฟะพ ะฐะดัะตัั:
- **Frontend**: http://localhost:8000/static/index.html
- **API Docs**: http://localhost:8000/docs
- **API (ReDoc)**: http://localhost:8000/redoc

## ๐ API Endpoints

### Users
```
GET    /api/users/{user_id}       # ะะพะปััะธัั ะฟะพะปัะทะพะฒะฐัะตะปั
POST   /api/users/register        # ะะตะณะธัััะฐัะธั (ะฟะฐัะพะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะธััะตััั)
POST   /api/users/login           # ะัะพะด (ะฟัะพะฒะตัะบะฐ ะฟะฐัะพะปั)
PUT    /api/users/{user_id}       # ะะฑะฝะพะฒะธัั ะฟัะพัะธะปั (ะฟะฐัะพะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะธััะตััั)
DELETE /api/users/{user_id}       # ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั (ะบะฐัะบะฐะดะฝะพะต ัะดะฐะปะตะฝะธะต)
```

### Movies
```
GET    /api/movies                # ะกะฟะธัะพะบ ัะธะปัะผะพะฒ
GET    /api/movies/{movie_id}     # ะะพะปััะธัั ัะธะปัะผ
POST   /api/movies                # ะกะพะทะดะฐัั ัะธะปัะผ
PUT    /api/movies/{movie_id}     # ะะฑะฝะพะฒะธัั ัะธะปัะผ
DELETE /api/movies/{movie_id}     # ะฃะดะฐะปะธัั ัะธะปัะผ (ะบะฐัะบะฐะดะฝะพะต ัะดะฐะปะตะฝะธะต)
```

### Reviews
```
GET    /api/reviews               # ะกะฟะธัะพะบ ัะตัะตะฝะทะธะน
GET    /api/reviews/{review_id}   # ะะพะปััะธัั ัะตัะตะฝะทะธั
POST   /api/reviews               # ะกะพะทะดะฐัั ัะตัะตะฝะทะธั (ั ะพะฟัะธะพะฝะฐะปัะฝัะผ ัะตะนัะธะฝะณะพะผ 1-5)
PUT    /api/reviews/{review_id}   # ะะฑะฝะพะฒะธัั ัะตัะตะฝะทะธั
DELETE /api/reviews/{review_id}   # ะฃะดะฐะปะธัั ัะตัะตะฝะทะธั
```

### Favorites
```
GET    /api/favorites             # ะะทะฑัะฐะฝะฝัะต ัะธะปัะผั ะฟะพะปัะทะพะฒะฐัะตะปั
POST   /api/favorites/{movie_id}  # ะะพะฑะฐะฒะธัั ะฒ ะธะทะฑัะฐะฝะฝะพะต
DELETE /api/favorites/{movie_id}  # ะฃะดะฐะปะธัั ะธะท ะธะทะฑัะฐะฝะฝะพะณะพ
```

> **ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั**: ัะผ. `API_CHANGES_V2.md`

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะฅะตัะธัะพะฒะฐะฝะธะต ะะฐัะพะปะตะน (v2.0.0)
ะัะต ะฟะฐัะพะปะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะธัััััั ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ bcrypt:

```python
# ะะตะณะธัััะฐัะธั - ะฟะฐัะพะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะธััะตััั
POST /api/users/register
{
  "email": "user@example.com",
  "username": "johndoe",
  "password": "mypassword"  # ะัะดะตั ัะตัะธัะพะฒะฐะฝ ะฐะฒัะพะผะฐัะธัะตัะบะธ
}

# ะะฑะฝะพะฒะปะตะฝะธะต - ะฟะฐัะพะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะธััะตััั
PUT /api/users/1
{
  "password": "newpassword"  # ะัะดะตั ัะตัะธัะพะฒะฐะฝ ะฐะฒัะพะผะฐัะธัะตัะบะธ
}

# ะัะพะด - ะฟัะพะฒะตัะบะฐ ะฑะตะทะพะฟะฐัะฝะฐั
POST /api/users/login
{
  "username": "johndoe",
  "password": "mypassword"  # ะัะพะฒะตััะตััั ั ัะตัะตะผ ะฒ ะะ
}
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
kino1/
โโโ app/
โ   โโโ alembic/                 # ะะธะณัะฐัะธะธ ะะ
โ   โ   โโโ versions/
โ   โ       โโโ 001_initial_migration.py
โ   โ       โโโ 002_restructure_and_password_hashing.py  # v2.0.0
โ   โโโ favorites/               # ะะทะฑัะฐะฝะฝัะต ัะธะปัะผั
โ   โ   โโโ models.py            # โจ NEW: ะะพะดะตะปั Favorite
โ   โ   โโโ router.py
โ   โ   โโโ schemas.py
โ   โ   โโโ dao.py
โ   โโโ reviews/                 # ะะตัะตะฝะทะธะธ
โ   โ   โโโ models.py            # โจ NEW: ะะพะดะตะปั Review
โ   โ   โโโ router.py
โ   โ   โโโ schemas.py
โ   โ   โโโ dao.py
โ   โโโ movies/
โ   โ   โโโ models.py
โ   โ   โโโ router.py
โ   โ   โโโ schemas.py
โ   โ   โโโ dao.py
โ   โโโ users/
โ   โ   โโโ models.py
โ   โ   โโโ router.py
โ   โ   โโโ schemas.py
โ   โ   โโโ dao.py
โ   โโโ static/                  # ะคัะพะฝัะตะฝะด
โ   โ   โโโ index.html
โ   โ   โโโ script.js
โ   โ   โโโ style.css
โ   โโโ main.py                  # FastAPI ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ db.py                    # ะะ ััะฝะบัะธะธ
โ   โโโ database.py              # ะะ ะบะพะฝัะธะณััะฐัะธั
โ   โโโ config.py                # ะะพะฝัะธะณััะฐัะธั
โ
โโโ init_db.py                   # ะะฝะธัะธะฐะปะธะทะฐัะธั ะะ
โโโ seed_db.py                   # ะะฐะฟะพะปะฝะตะฝะธะต ัะตััะพะฒัะผะธ ะดะฐะฝะฝัะผะธ
โโโ run.py                       # ะขะพัะบะฐ ะฒัะพะดะฐ
โโโ requirements.txt             # ะะฐะฒะธัะธะผะพััะธ
โ
โโโ MIGRATION_NOTES.md           # ะะฐะนะด ะผะธะณัะฐัะธะธ
โโโ API_CHANGES_V2.md            # API ะดะพะบัะผะตะฝัะฐัะธั v2.0.0
โโโ CHANGELOG.md                 # ะััะพัะธั ะฒะตััะธะน
โโโ DEVELOPMENT.md               # ะะฐะนะด ัะฐะทัะฐะฑะพัะบะธ
โโโ REFACTORING_SUMMARY.md       # ะะตะทัะผะต ัะตัะฐะบัะพัะธะฝะณะฐ
โโโ v2.0.0_COMPLETION_REPORT.md  # ะััะตั ะพ ะทะฐะฒะตััะตะฝะธะธ
โโโ README.md                    # ะญัะพั ัะฐะนะป
```

## ๐พ ะขะตััะพะฒัะต ะะบะบะฐัะฝัั

ะะพัะปะต ะทะฐะฟััะบะฐ `seed_db.py` ะดะพัััะฟะฝั ัะปะตะดัััะธะต ะฐะบะบะฐัะฝัั:

**ะะพะดะตัะฐัะพั:**
- Email: `moderator@kinovzor.ru`
- Password: `admin123`

**ะะพะปัะทะพะฒะฐัะตะปั (ะฟัะธะผะตั):**
- Email: `ivanov@mail.ru`
- Password: `viewer123`

## ๐ ะะพะปะธ ะะพะปัะทะพะฒะฐัะตะปะตะน

- **๐ค ะัะพัััะต ะฟะพะปัะทะพะฒะฐัะตะปะธ**: ััะตะฝะธะต ัะธะปัะผะพะฒ, ะฝะฐะฟะธัะฐะฝะธะต ัะตัะตะฝะทะธะน, ะพัะตะฝะบะธ
- **๐ฎ ะะพะดะตัะฐัะพัั**: ะพะดะพะฑัะตะฝะธะต/ะพัะบะปะพะฝะตะฝะธะต ัะตัะตะฝะทะธะน
- **๐จโ๐ผ ะะดะผะธะฝั**: ัะฟัะฐะฒะปะตะฝะธะต ัะธะปัะผะฐะผะธ, ัะบัะฟะพัั/ะธะผะฟะพัั

## ๐ ะะพะบัะผะตะฝัะฐัะธั

ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฟัะพะตะบัะฐ:

1. **MIGRATION_NOTES.md** - ะะฐะนะด ะผะธะณัะฐัะธะธ ั v1.0.0 ะฝะฐ v2.0.0
2. **API_CHANGES_V2.md** - ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั API ั ะฟัะธะผะตัะฐะผะธ
3. **DEVELOPMENT.md** - ะะฐะนะด ัะฐะทัะฐะฑะพัะบะธ ะธ ะดะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒัั ััะฝะบัะธะน
4. **CHANGELOG.md** - ะััะพัะธั ะฒัะตั ะฒะตััะธะน
5. **REFACTORING_SUMMARY.md** - ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ะฒัะตั ะธะทะผะตะฝะตะฝะธะน

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะก ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ cURL

```bash
# ะะตะณะธัััะฐัะธั
curl -X POST http://localhost:8000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","username":"testuser","password":"test123"}'

# ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะพัะธะปั
curl -X PUT http://localhost:8000/api/users/1 \
  -H "Content-Type: application/json" \
  -d '{"username":"newname"}'

# ะฃะดะฐะปะตะฝะธะต ะฐะบะบะฐัะฝัะฐ
curl -X DELETE http://localhost:8000/api/users/1

# ะะพะปััะธัั ัะธะปัะผ
curl http://localhost:8000/api/movies/1

# ะกะพะทะดะฐัั ัะตัะตะฝะทะธั
curl -X POST http://localhost:8000/api/reviews \
  -H "Content-Type: application/json" \
  -d '{"movie_id":1,"user_id":1,"text":"ะัะปะธัะฝัะน ัะธะปัะผ!","rating":5}'
```

### ะก ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Python

```python
import requests

BASE_URL = "http://localhost:8000/api"

# ะะตะณะธัััะฐัะธั
resp = requests.post(f"{BASE_URL}/users/register", json={
    "email": "user@example.com",
    "username": "user",
    "password": "pass123"
})
print(resp.json())

# ะะฑะฝะพะฒะปะตะฝะธะต ะฟัะพัะธะปั
resp = requests.put(f"{BASE_URL}/users/1", json={
    "username": "newname",
    "password": "newpass123"  # ะะฐัะพะปั ะฑัะดะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะธัะพะฒะฐะฝ
})
print(resp.json())
```

## ๐ ะะตัะตะฝะธะต ะัะพะฑะปะตะผ

### Database Lock
ะัะปะธ ะฟะพะปััะธัะต ะพัะธะฑะบั "database is locked":
```bash
rm kinovzor.db-journal
python run.py
```

### Migration Issues
ะัะปะธ ะฟัะพะฑะปะตะผั ั ะผะธะณัะฐัะธัะผะธ:
```bash
cd app
alembic stamp head
alembic upgrade head
cd ..
```

### Password Not Hashing
ะฃะฑะตะดะธัะตัั ััะพ ะธัะฟะพะปัะทัะตัะต `create_user()` ะธะปะธ `update_user()` ะธะท `app/db.py`

## ๐ ะะธัะตะฝะทะธั

MIT License - ัะผ. LICENSE ัะฐะนะป

## ๐จโ๐ป ะะฒัะพั

Artem2335 - https://github.com/Artem2335

## ๐ ะะพะฟัะพัั ะธ ะะพะดะดะตัะถะบะฐ

ะะปั ะฒะพะฟัะพัะพะฒ ะธ ะฟะพะดะดะตัะถะบะธ:
1. ะงะธัะฐะนัะต ะดะพะบัะผะตะฝัะฐัะธั ะฒ `DEVELOPMENT.md`
2. ะัะพะฒะตัััะต `API_CHANGES_V2.md` ะดะปั API ะดะตัะฐะปะตะน
3. ะกะผะพััะธัะต `MIGRATION_NOTES.md` ะดะปั ะผะธะณัะฐัะธะธ

---

**ะะตััะธั**: 2.0.0  
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต**: 2025-12-17  
**ะกัะฐััั**: โ PRODUCTION READY
