# KinoVzor - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ª—É—á—à–µ–Ω–∏—è

## üìã –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–î–µ–∫–∞–±—Ä—å 2025)

#### üéØ Frontend Fixes
- ‚úÖ **Fix 422 Error**: –†–µ—Ü–µ–Ω–∑–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ body, –∞ –Ω–µ –≤ query params
- ‚úÖ **Fix DELETE Reviews**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint `/api/reviews/{id}`
- ‚úÖ **Rating System**: –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ –≤—Å–µ—Ö —Ä–µ—Ü–µ–Ω–∑–∏–π —Å –æ—Ü–µ–Ω–∫–∞–º–∏

#### üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ **index.html –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞**: –ò–∑ `app/static/` –≤ `app/templates/`
- ‚úÖ **Jinja2 Templates**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Jinja2Templates` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- ‚úÖ **API Routes**: –û—Å—Ç–∞—é—Ç—Å—è –≤ `/api/*`, —Å—Ç–∞—Ç–∏–∫–∞ –≤ `/static/*`

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

```
kino1/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stylr.css          # –°—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ script.js           # JavaScript
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ favicon.svg         # –ò–∫–æ–Ω–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã)
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.html          # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (Jinja2)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ db.py                   # –§—É–Ω–∫—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îú‚îÄ‚îÄ movies/
‚îÇ   ‚îú‚îÄ‚îÄ reviews/
‚îÇ   ‚îî‚îÄ‚îÄ favorites/
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ kinovzor.db                 # –ë–î SQLite
‚îî‚îÄ‚îÄ run.py                      # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python run.py

# 3. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://127.0.0.1:8000
```

---

## üîó API Endpoints

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `POST /api/users/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/users/login` - –í—Ö–æ–¥

### –§–∏–ª—å–º—ã
- `GET /api/movies/` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∏–ª—å–º–æ–≤
- `GET /api/movies/{id}` - –î–µ—Ç–∞–ª–∏ —Ñ–∏–ª—å–º–∞ (—Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º)
- `GET /api/movies/{id}/rating-stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞
- `GET /api/movies/stats` - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∞–π—Ç–∞

### –†–µ—Ü–µ–Ω–∑–∏–∏
- `GET /api/movies/{id}/reviews` - –†–µ—Ü–µ–Ω–∑–∏–∏ –ø–æ —Ñ–∏–ª—å–º—É
- `POST /api/movies/{id}/reviews` - –°–æ–∑–¥–∞—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é
- `DELETE /api/reviews/{id}` - –£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é (–º–æ–¥–µ—Ä–∞—Ç–æ—Ä)

### –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
- `GET /api/movies/user/{user_id}/favorites` - –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã
- `POST /api/movies/{id}/favorites` - –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `DELETE /api/movies/{id}/favorites` - –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

---

## üí° –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### Rating System (–†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)
- **–†–∞—Å—á—ë—Ç**: –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ = AVG(rating) –∏–∑ –≤—Å–µ—Ö —Ä–µ—Ü–µ–Ω–∑–∏–π —Å –æ—Ü–µ–Ω–∫–∞–º–∏
- **–í–∫–ª—é—á–µ–Ω–∏–µ**: –í—Å–µ —Ä–µ—Ü–µ–Ω–∑–∏–∏ —Å `rating IS NOT NULL` (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ approved)
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –í –º–æ–¥–∞–ª–∫–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∏–ª—å–º–∞

### Frontend Architecture
- **index.html**: –¢–µ–ø–µ—Ä—å –≤ `templates/`, –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Jinja2
- **Static Files**: CSS, JS, favicon –æ—Å—Ç–∞—é—Ç—Å—è –≤ `static/`
- **Root Route** (`/`): –†–µ–Ω–¥–µ—Ä–∏—Ç `index.html` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞

### Database (–ë–î)
- **SQLite**: `kinovzor.db`
- **–¢–∞–±–ª–∏—Ü—ã**: users, movies, reviews, favorites, ratings
- **–§—É–Ω–∫—Ü–∏–∏**: –í `app/db.py`

---

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ 422 (Unprocessable Content)
**–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ—Ü–µ–Ω–∑–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å —Å `user_id` –≤ query param
```javascript
// –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
await apiCall('POST', `/movies/${mid}/reviews?user_id=${currentUser.id}`, {
  text: txt,
  rating: currentMovieRating,
});

// –ü–û–°–õ–ï (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
await apiCall('POST', `/movies/${mid}/reviews`, {
  user_id: currentUser.id,
  text: txt,
  rating: currentMovieRating,
});
```

### –û—à–∏–±–∫–∞ 404 (Not Found)
**–ü—Ä–æ–±–ª–µ–º–∞**: DELETE –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/movies/reviews/{id}` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π path)
```javascript
// –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
await apiCall('DELETE', `/movies/reviews/${reviewId}`);

// –ü–û–°–õ–ï (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
await apiCall('DELETE', `/reviews/${reviewId}`);
```

---

## üìù Commits

```
0f82a12 refactor: Remove index.html from static (moved to templates)
3806893 refactor: Use Jinja2 templates for index.html from app/templates
ce61ddf feat: Move index.html to app/templates
8fdd0aa fix: Calculate rating from ALL reviews (not just approved)
158e4be fix: Use correct DELETE endpoint for reviews
26b1c6b fix: Send review data in request body instead of query params
```

---

## ‚úÖ Checklist

- [x] index.html –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ templates/
- [x] main.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jinja2Templates
- [x] API routes —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Rating stats –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [x] –†–µ—Ü–µ–Ω–∑–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –†–µ—Ü–µ–Ω–∑–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ endpoint
- [x] –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç—Å—è –∏–∑ /static/
- [x] requirements.txt —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

## üéÆ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –í—Ö–æ–¥ –∫–∞–∫ –≥–æ—Å—Ç—å (–±–µ–∑ —Ä–µ—Ü–µ–Ω–∑–∏–π)
- ‚úÖ –†–æ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ (—É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Ü–µ–Ω–∑–∏–π)

### –§–∏–ª—å–º—ã
- ‚úÖ –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –∂–∞–Ω—Ä–∞–º
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏, –Ω–∞–∑–≤–∞–Ω–∏—é, –≥–æ–¥—É)
- ‚úÖ –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏

### –†–µ—Ü–µ–Ω–∑–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Ü–µ–Ω–∑–∏–π —Å –æ—Ü–µ–Ω–∫–æ–π (1-5 –∑–≤—ë–∑–¥)
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Ü–µ–Ω–∑–∏–π
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Ü–µ–Ω–∑–∏–π (—Ç–æ–ª—å–∫–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–ª—å–º–æ–≤ –∏ —Ä–µ—Ü–µ–Ω–∑–∏–π

### –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å–º–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ –≤ –ø—Ä–æ—Ñ–∏–ª–µ

---

**–í–µ—Ä—Å–∏—è**: 2.0.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 17 –¥–µ–∫–∞–±—Ä—è 2025
